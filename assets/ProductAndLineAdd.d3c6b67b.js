import{g as e,y as t,k as a,u as s,c as l,l as n,m as o,r as u,a as r,d as i,t as c,b as d,w as p,j as v,f as m,i as h,G as y,F as I,q as S,z as L,B as f,I as b,o as T,e as x}from"./vendor.5e620042.js";import{_ as P,i as C,d as w,g as k,o as A,a as O,n as _,e as N}from"./index.647400d6.js";import{d as M}from"./vuedraggable.umd.43489d49.js";const E={class:"mainPaddingX"},g={class:"py-4 text-4xl text-title-h1"},j={class:"py-6 px-4 sm:px-2 sm:py-4 w-full shadow text-gray-500 text-sm myBorder"},B={class:"flex justify-between sm:block"},U={class:"order-2 sm:order-1 min-w-max sm:min-w-fit mb-3 sm:mb-0"},$={class:"btn btnBlueColor mr-2 sm:mb-3"},D={class:"articleTitle order-1 sm:order-2 mb-3 mr-2 sm:mr-0"},R={class:"flex"},G={class:"inputTitle myInputSearchTitle rounded-l"},V={value:"",disabled:"",hidden:""},F=["value"],q={class:"flex mt-3"},W={class:"inputTitle myInputSearchTitle rounded-l"},H={value:"",disabled:"",hidden:""},z=["value"],J={key:0,class:"flex mt-3"},K={class:"inputTitle myInputSearchTitle rounded-l"},X={class:"relative w-full flex items-center"},Y={class:"flex items-center absolute targetInputIcon"},Q={key:0,class:"text-green-400"},Z={key:1,class:"text-red-600"},ee={key:0,class:"pl-6 py-4 bg-yellow-100 text-yellow-700 rounded"},te={key:1,class:"pl-6 py-4 bg-red-100 text-red-700 rounded"},ae={key:0},se={class:"infoBlock p-3 flex xl:block justify-between items-center myBorder shadow"},le={class:"flex items-center justify-center xl:justify-between xl:mb-2"},ne=["onClick"],oe={class:"flex xl:mb-2"},ue={class:"inputTitle myInputSearchTitle rounded-l"},re=["onUpdate:modelValue"],ie={class:"flex xl:mb-2"},ce={class:"inputTitle myInputSearchTitle rounded-l"},de=["onUpdate:modelValue","onChange"],pe={value:"0",disabled:"",hidden:""},ve=["value"],me={key:0},he={class:"flex xl:mb-2"},ye={class:"inputTitle myInputSearchTitle rounded-l"},Ie=["onUpdate:modelValue"],Se={class:"flex justify-center xl:justify-start xl:mb-2"},Le={class:"inputTitle myInputSearchTitle rounded-l"},fe=["onUpdate:modelValue"],be={class:"flex"},Te={class:"inputTitle myInputSearchTitle rounded-l"},xe=["onUpdate:modelValue"],Pe={class:"flex justify-end xl:hidden"},Ce=["onClick"],we={class:"flex flex-wrap justify-end px-3"},ke={type:"submit",class:"btn btnBlueColor"};var Ae=P({setup(P){const Ae=e(),Oe=t(),_e=a(),Ne=s(),Me=l((()=>Ae.locale.value)),Ee=l((()=>Ne.state.resData.adminName)),ge=l((()=>Ne.state.resData.token)),je=l((()=>Ne.state.serverURL)),Be=l((()=>{let e=Ne.state.resData.adminPagesPermit,t=[];return"string"==typeof e&&(t=e.split(",")),t.find((e=>6==e))})),Ue=l((()=>C(Me.value))),$e=N(),De=$e.isNumeric,Re=$e.isObject,Ge=n(Oe.query.lineId),Ve=n({}),Fe=n([]),qe=n({}),We=n(""),He=n({}),ze=()=>console.warn("lineId/productId/processId error");const Je=l((()=>({line:{lineId:Object.keys(Ve.value),lineName:Object.values(Ve.value)},process:{processId:Object.keys(qe.value),processName:Object.values(qe.value)},product:{productId:Object.keys(He.value),productName:Object.values(He.value)}}))),Ke=n(new class{constructor(){this.isStatus4=!1,this.isNoMachine=!1,this.isShowAll=!1}set(e="initial"){this.isStatus4=!1,this.isNoMachine=!1,this.isShowAll=!1,"isStatus4"==e&&(this.isStatus4=!0),"isNoMachine"==e&&(this.isNoMachine=!0),"isShowAll"==e&&(this.isShowAll=!0)}}),Xe=n(""),Ye=n(""),Qe=n([]),Ze=()=>{if(!Ge.value)return ze();let e=new FormData;e.append("token",ge.value),e.append("lineId",Ge.value),e.append("productId",Xe.value),b.post(`http://${je.value}/product_machine.php`,e).then((e=>{if(w(e.data),1==e.data.status){let t=e.data.data;console.log("data",t),Ve.value=Re(t.lineList)?t.lineList:{},Fe.value=Array.isArray(t.machineList)?t.machineList:[],qe.value=Re(t.processList)?t.processList:{},We.value=De(t.processMajorId)?t.processMajorId:"",He.value=Re(t.productList)?t.productList:{},0==Fe.value.length?Ke.value.set("isNoMachine"):Xe.value?Ke.value.set("isShowAll"):Ke.value.set("initial"),Qe.value=function(){let e=k(Fe.value);return e.map((e=>{e.processId="0",e.processStitchP="",e.processStitchM="",e.processStitch="",e.processCut="",e.processType="",e.Stitch="",e.typeTranslation=""})),e}()}else 2==e.data.status?Ne.dispatch("tokenCheckFail"):3==e.data.status?(console.warn("status 3"),ze()):4==e.data.status?(console.warn("status 4"),Ke.value.set("isStatus4")):console.warn("else")})).catch((e=>console.error("error")))};Ze();const et=()=>{let e=Je.value.product.productName||[],t=k(e).map((e=>{let t=e.split(/[(,)]/),a=t[0]||"",s=t[1]||"";return{productName:a.trim(),productSize:s.trim()}}));Ne.commit("onPopupForm","productAdd"),Ne.commit("onPopupOtherData",t);let a=JSON.stringify({lineId:Ge.value,hint:"for TheProductSetEdits backBtn that can go back this ProductAndLineAdd.vue not go to TheProductSet.vue"});sessionStorage.setItem("ProductAndLineAdd",a)},tt=e=>{Qe.value[e].processId="0",Qe.value[e].processStitchP="",Qe.value[e].processStitchM="",Qe.value[e].processStitch="",Qe.value[e].processCut="",Qe.value[e].processType="",Qe.value[e].Stitch="",Qe.value[e].typeTranslation=""},at=(st=!1,()=>{if(!st){if(!Ge.value||!Xe.value)return ze();let e=A(Me.value);if(Number(Ye.value)<=0)return alert(e.targetSettingError);if(!Qe.value.some((e=>e.processId&&"0"!=e.processId)))return alert(e.atLeastOneMachine);st=!0;let t=new FormData;t.append("token",ge.value),t.append("adminName",Ee.value),t.append("lineId",Ge.value),t.append("productId",Xe.value),t.append("target",Math.ceil(Number(Ye.value))),Qe.value.forEach((e=>{let a=e.machineId,s=e.processId;a&&s&&t.append(`process[${a}]`,s)})),b.post(`http://${je.value}/insertsql/prodmac.php`,t).then((t=>{if(w(t.data),1==t.data.status){let e=O(Me.value).saveSuccess;alert(e),_e.push({name:"ProductionLineSet",params:{lineId:Ge.value}})}else 2==t.data.status?Ne.dispatch("tokenCheckFail"):3==t.data.status?ze():4==t.data.status?(console.warn("status 4"),alert(e.productWithoutMajorProcess)):5==t.data.status?(console.warn("status 5"),alert(e.selectMajorProcess)):console.warn("else")})).catch((e=>{console.error("error")})).finally((()=>{st=!1}))}});var st;return o((()=>Ge.value),(()=>{_e.push({name:"ProductLineAdd",query:{lineID:Ge.value}}),Ze()})),o((()=>Xe.value),(()=>Ze())),o((()=>Me.value),(()=>{Qe.value.map((e=>{e.typeTranslation=Ue.value[e.processType]||""}))})),(e,t)=>{const a=u("router-link");return T(),r("main",E,[i("h1",g,c(e.$t("PRODUCT_LINE.PL_PROD")),1),i("div",j,[i("section",B,[i("article",U,[d(a,{to:"/production_line_set"},{default:p((()=>[i("button",$,c(e.$t("ProductMachine.PM_BACK")),1)])),_:1}),v(Be)?(T(),r("button",{key:0,class:"btn btnBlueColor sm:mb-3",onClick:et},c(e.$t("PRODUCT_LINE.PL_ADD_PRODUCT")),1)):m("",!0)]),i("article",D,[i("div",R,[i("div",G,c(e.$t("PRODUCT_LINE.PL_LINE")),1),h(i("select",{class:"w-full myInputSearch rounded-r rounded-l-none","onUpdate:modelValue":t[0]||(t[0]=e=>Ge.value=e),required:""},[i("option",V,c(e.$t("ProductMachine.PM_SELECT")),1),(T(!0),r(I,null,S(v(Je).line.lineName,((e,t)=>(T(),r("option",{key:"lineList"+t,value:v(Je).line.lineId[t]},c(e),9,F)))),128))],512),[[y,Ge.value]])]),i("div",q,[i("div",W,c(e.$t("GLOBAL.GLOBAL_PRODUCT")),1),h(i("select",{class:"w-full myInputSearch rounded-r rounded-l-none","onUpdate:modelValue":t[1]||(t[1]=e=>Xe.value=e),required:""},[i("option",H,c(e.$t("ProductMachine.PM_SELECT")),1),(T(!0),r(I,null,S(v(Je).product.productName,((e,t)=>(T(),r("option",{key:"productList"+t,value:v(Je).product.productId[t]},c(e),9,z)))),128))],512),[[y,Xe.value]])]),Ke.value.isShowAll?(T(),r("div",J,[i("div",K,c(e.$t("PRODUCT_LINE.PL_TARGET")),1),i("div",X,[h(i("input",{type:"number",min:"0",step:"1",class:"myInputSearch w-full rounded-l-none targetInput",placeholder:"0","onUpdate:modelValue":t[2]||(t[2]=e=>Ye.value=e),required:""},null,512),[[L,Ye.value]]),i("div",Y,[Ye.value?(T(),r("span",Q,"✔")):(T(),r("span",Z,"✖"))])])])):m("",!0)])]),i("section",null,[i("article",null,[Ke.value.isStatus4?(T(),r("div",ee,c(e.$t("PRODUCT_LINE.PL_DOUBLE_MATCH")),1)):m("",!0),Ke.value.isNoMachine?(T(),r("div",te,c(e.$t("PRODUCT_LINE.PL_NO_MACHINES")),1)):m("",!0)])]),Ke.value.isShowAll?(T(),r("section",ae,[i("form",{onSubmit:t[3]||(t[3]=f(((...e)=>v(at)&&v(at)(...e)),["prevent"]))},[i("article",null,[d(v(M),{list:Qe.value,"item-key":"name",class:"flex flex-wrap"},{item:p((({element:t,index:a})=>[i("div",se,[i("div",le,[x(c(a+1)+" ",1),i("button",{class:"btn btnBlueColor hidden xl:inline-block",onClick:f((e=>tt(a)),["prevent"])},c(e.$t("ProductMachine.PM_CLEAR")),9,ne)]),i("div",oe,[i("div",ue,c(e.$t("GLOBAL.GLOBAL_MACHINE")),1),h(i("input",{type:"text",class:"rounded-l-none myInputReadonly cursor-move inputWidth","onUpdate:modelValue":e=>t.machineName=e,readonly:""},null,8,re),[[L,t.machineName]])]),i("div",ie,[i("div",ce,c(e.$t("GLOBAL.GLOBAL_PROCESS")),1),h(i("select",{class:"myInputSearch rounded-l-none selectWidth","onUpdate:modelValue":e=>t.processId=e,onChange:e=>(e=>{let t=Qe.value[e].processId,a=new FormData;a.append("token",ge.value),a.append("processId",t),b.post(`http://${je.value}/autofill-ajax.php`,a).then((t=>{if(w(t.data),1==t.data.status){let a=t.data.data;if(Re(a)){let t=a.processStitch,s=a.processStitchP,l=a.processStitchM;Qe.value[e].processId=a.processId||"",Qe.value[e].processStitch=t||"",Qe.value[e].processStitchP=s||"",Qe.value[e].processStitchM=l||"",Qe.value[e].processCut=a.processCut||"",Qe.value[e].processType=a.processType||"",Qe.value[e].Stitch=_(t,s,l),Qe.value[e].typeTranslation=Ue.value[a.processType]||""}}else 2==t.data.status?Ne.dispatch("tokenCheckFail"):3==t.data.status?(console.warn("status 3"),ze()):console.warn("else")})).catch((e=>{console.warn("error")}))})(a)},[i("option",pe,c(e.$t("ProductMachine.PM_SELECT")),1),(T(!0),r(I,null,S(v(Je).process.processName,((e,t)=>(T(),r("option",{key:"processList"+t,value:v(Je).process.processId[t]},[We.value==v(Je).process.processId[t]?(T(),r("span",me,"☆")):m("",!0),x(" "+c(e),1)],8,ve)))),128))],40,de),[[y,t.processId]])]),i("div",he,[i("div",ye,[i("div",null,c(e.$t("GLOBAL.GLOBAL_STITCH")),1)]),h(i("input",{type:"text",class:"rounded-l-none myInputReadonly inputWidth","onUpdate:modelValue":e=>t.Stitch=e,readonly:""},null,8,Ie),[[L,t.Stitch]])]),i("div",Se,[i("div",Le,c(e.$t("GLOBAL.GLOBAL_TRIM")),1),h(i("input",{type:"text",class:"w-10 xl:w-full rounded-l-none myInputReadonly","onUpdate:modelValue":e=>t.processCut=e,readonly:""},null,8,fe),[[L,t.processCut]])]),i("div",be,[i("div",Te,c(e.$t("ProductSet.PROSET_COUNTSTYLE")),1),h(i("input",{type:"text",class:"rounded-l-none myInputReadonly inputWidth","onUpdate:modelValue":e=>t.typeTranslation=e,readonly:""},null,8,xe),[[L,t.typeTranslation]])]),i("div",Pe,[i("button",{class:"btn btnBlueColor",onClick:f((e=>tt(a)),["prevent"])},c(e.$t("ProductMachine.PM_CLEAR")),9,Ce)])])])),_:1},8,["list"])]),i("article",we,[i("button",ke,c(e.$t("GLOBAL.GLOBAL_SAVE")),1)])],32)])):m("",!0)])])}}},[["__scopeId","data-v-38e7bbe6"]]);export{Ae as default};
